<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="theme-color" content="#0b1226" />
  <link id="app-touch-icon" rel="apple-touch-icon" sizes="180x180" href="" />
  <link id="app-favicon" rel="icon" type="image/png" href="" />
  <title>Contador: Ella y Él</title>
  <style>
    :root {
      --text: #eaf6ff;
      --neon-ella: #ff4d9d;
      --neon-el: #00e5ff;
      --neon-green: #39ff14;
      --panel: rgba(8, 10, 26, 0.6);
      --border: rgba(255, 255, 255, 0.08);
      /* posición del foco para el fondo (se actualiza con el puntero) */
      --mx: 50vw;
      --my: 50vh;
    }

    * { box-sizing: border-box; }

    html, body { height: 100%; }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(60vmax 60vmax at var(--mx) var(--my), #0b1226 0%, #090f20 40%, #060b18 65%, #030712 100%);
      color: var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .wrapper { width: min(1024px, 96vw); }

    /* Dos cuadros horizontales */
    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr; /* dos columnas (horizontal) */
      gap: 18px;
    }

    .card {
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 45vh; /* alto generoso para que sean "cuadros" */
      padding: 28px;
      border-radius: 22px;
      background: linear-gradient(180deg, rgba(12, 14, 32, 0.72), rgba(6, 8, 24, 0.68));
      border: 1.5px solid var(--border);
      backdrop-filter: blur(8px);
      user-select: none;
      cursor: pointer;
      transition: transform .08s ease, background .25s ease, box-shadow .25s ease, filter .25s ease;
      outline: none;
      overflow: hidden;
      isolation: isolate;
    }

    /* Color neón por persona */
    .card[data-person="ella"] { --neon: var(--neon-ella); }
    .card[data-person="el"] { --neon: var(--neon-el); }

    /* Aro brillante en el borde */
    .card::before {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: inherit;
      pointer-events: none;
      background: radial-gradient(140% 140% at 50% 0%, color-mix(in oklab, var(--neon) 30%, transparent), transparent 60%);
      mix-blend-mode: screen;
      opacity: .7;
      z-index: -1;
    }

    .card:hover {
      transform: translateY(-2px) scale(1.01);
      background: linear-gradient(180deg, rgba(16, 18, 44, 0.78), rgba(8, 10, 28, 0.74));
      box-shadow: 0 0 20px var(--neon), 0 0 60px color-mix(in oklab, var(--neon) 30%, transparent);
      filter: drop-shadow(0 0 24px var(--neon));
    }

    .card:active { transform: scale(.985); }

    .card h2.name {
      margin: 0 0 12px 0;
      font-size: clamp(1.1rem, 3vw, 2rem);
      font-weight: 800;
      letter-spacing: .4px;
      text-transform: uppercase;
      text-shadow: 0 0 3px var(--neon), 0 0 8px var(--neon), 0 0 18px var(--neon);
      cursor: pointer; /* renombrar al tocar */
    }

    .count {
      font-weight: 900;
      font-size: clamp(3.5rem, 11vw, 9rem);
      line-height: 1;
      letter-spacing: -1px;
      text-shadow: 0 0 6px var(--neon), 0 0 16px var(--neon), 0 0 38px var(--neon);
    }

    /* Toolbar, resumen e instrucciones */
    .toolbar { display:flex; justify-content:flex-end; align-items:center; margin-bottom:12px; gap:8px; }
    .btn { appearance:none; border:1px solid var(--border); background: linear-gradient(180deg, rgba(18,22,48,.8), rgba(10,12,28,.8)); color: var(--text); padding:10px 14px; border-radius:14px; font-weight:700; letter-spacing:.3px; cursor:pointer; transition: transform .06s ease, box-shadow .2s ease, filter .2s ease; }
    .btn:hover { box-shadow: 0 0 14px color-mix(in oklab, var(--neon-el) 35%, transparent); }
    .btn:active { transform: scale(.98); }
    .btn.reset { text-transform: uppercase; }
    .btn.toggle.on { box-shadow: 0 0 16px color-mix(in oklab, var(--neon-el) 45%, transparent); outline: 1px solid rgba(255,255,255,.14); }

    .summary-card { margin: 8px 0 14px; border-radius: 16px; border: 1px solid rgba(57,255,20,0.25); background: linear-gradient(180deg, rgba(10,22,10,.35), rgba(6,16,6,.28)); box-shadow: 0 0 18px rgba(57,255,20,0.25) inset, 0 0 30px rgba(57,255,20,0.15); padding: 10px 14px; color: var(--text); }
    .stats { text-align:center; margin: 0; }
    .stats .total { font-weight: 900; text-transform: uppercase; letter-spacing:.6px; color: var(--neon-green); font-size: clamp(1rem, 2.2vw, 1.4rem); text-shadow: 0 0 6px rgba(57,255,20,.6), 0 0 18px rgba(57,255,20,.35), 0 0 36px rgba(57,255,20,.18); }
    .stats .detail { margin-top: 2px; font-weight: 700; opacity:.95; font-size: clamp(.9rem, 1.6vw, 1rem); }
    .stats .name-a { color: var(--neon-ella); text-shadow: 0 0 6px color-mix(in oklab, var(--neon-ella) 60%, transparent); }
    .stats .name-b { color: var(--neon-el); text-shadow: 0 0 6px color-mix(in oklab, var(--neon-el) 60%, transparent); }
    .stats .pct { opacity:.9; font-weight:800; }

    .instructions { margin-top: 10px; text-align:center; opacity:.85; font-size:.95rem; }

    /* Bloquea el zoom por doble-tap (mantiene pinch-zoom) */
    body, .card { touch-action: manipulation; }

    @media (max-width: 680px) {
      /* En móvil: flujo normal (no centrado vertical) y controles siempre visibles */
      body { display: block; }
      .wrapper { width: 100vw; padding: 12px; margin: 0 auto; }
      .grid { gap: 12px; grid-template-columns: 1fr; }
      .card { min-height: 42vh; padding: 20px; }
      .toolbar { position: sticky; top: calc(env(safe-area-inset-top, 0px) + 8px); z-index: 100; }
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <div class="toolbar" role="region" aria-label="Controles">
      <button type="button" class="btn" id="btn-undo" aria-label="Deshacer último toque">Undo</button>
      <button type="button" class="btn reset" id="btn-reset" aria-label="Reiniciar contadores">Reset</button>
      <button type="button" class="btn toggle" id="btn-sound" aria-pressed="false" aria-label="Alternar sonido/háptica">Sonido: OFF</button>
    </div>

    <div class="summary-card" role="region" aria-label="Resumen total">
      <div class="stats" id="stats" aria-live="polite" aria-atomic="true"></div>
    </div>

    <div class="grid">
      <div class="card" id="ella" data-person="ella" role="button" aria-pressed="false" tabindex="0" aria-label="Sumar 1 punto a Ella">
        <h2 class="name">Ella</h2>
        <div class="count" aria-live="polite" aria-atomic="true">0</div>
      </div>

      <div class="card" id="el" data-person="el" role="button" aria-pressed="false" tabindex="0" aria-label="Sumar 1 punto a Él">
        <h2 class="name">Él</h2>
        <div class="count" aria-live="polite" aria-atomic="true">0</div>
      </div>
    </div>

    <div class="instructions">Toque = +1 · Mantener = −1 · Toca el nombre para renombrar.</div>
  </div>

  <script>
    // === Contadores con persistencia ===
    const history = [];
    function pushAction(id, delta){ history.push({ id, delta }); }

    function setupCounter(cardId, storageKey) {
      const card = document.getElementById(cardId);
      const countEl = card.querySelector('.count');
      let count = parseInt(localStorage.getItem(storageKey) || '0', 10);

      const render = () => { countEl.textContent = count; };
      render();

      function change(delta, record=true) {
        const prev = count;
        count = Math.max(0, count + delta);
        if (count === prev) return; // no baja de 0
        localStorage.setItem(storageKey, String(count));
        render();
        if (record) pushAction(cardId, delta);
        feedback(delta);
        updateTotals();
      }

      function setValue(v) {
        const val = Math.max(0, parseInt(v, 10) || 0);
        count = val;
        localStorage.setItem(storageKey, String(count));
        render();
      }

      // Tap = +1, pulsación larga = -1
      let pressTimer = null;
      let longPressFired = false;

      const onPointerDown = (e) => {
        e.preventDefault();
        longPressFired = false;
        pressTimer = setTimeout(() => { longPressFired = true; change(-1); }, 500);
      };
      const clearPress = () => { if (pressTimer) { clearTimeout(pressTimer); pressTimer = null; } };
      const onPointerUp = (e) => { if (!pressTimer) return; clearPress(); if (!longPressFired) change(+1); };

      card.addEventListener('pointerdown', onPointerDown);
      card.addEventListener('pointerup', onPointerUp);
      card.addEventListener('pointerleave', clearPress);
      card.addEventListener('pointercancel', clearPress);

      // Teclado: Espacio/Enter = +1
      card.addEventListener('keydown', (e) => {
        if (e.code === 'Space' || e.code === 'Enter') { e.preventDefault(); change(+1); }
      });

      // Exponer helpers
      card._setValue = setValue;
      card._getValue = () => count;
      card._applyDelta = (d, record=false) => change(d, record);
    }

    // === Renombrar tocando el título ===
    function setupName(cardId, defaultName, storageKey){
      const card = document.getElementById(cardId);
      const nameEl = card.querySelector('h2.name');
      let name = (localStorage.getItem(storageKey) || defaultName).trim() || defaultName;
      nameEl.textContent = name;
      card.setAttribute('aria-label', `Sumar 1 punto a ${name}`);

      const openPrompt = () => {
        const proposed = prompt('Nombre para este contador:', name);
        if (proposed === null) return; // cancelado
        const nn = proposed.trim().slice(0, 24);
        if (!nn) return;
        name = nn;
        nameEl.textContent = name;
        localStorage.setItem(storageKey, name);
        card.setAttribute('aria-label', `Sumar 1 punto a ${name}`);
        updateTotals();
      };
      // Evitar que tocar el nombre sume/resta
      nameEl.addEventListener('pointerdown', (e)=> e.stopPropagation());
      nameEl.addEventListener('pointerup',   (e)=> e.stopPropagation());
      nameEl.addEventListener('pointercancel', (e)=> e.stopPropagation());
      nameEl.addEventListener('click', (e)=> { e.stopPropagation(); openPrompt(); });
      nameEl.addEventListener('touchend', (e)=> { e.stopPropagation(); e.preventDefault(); openPrompt(); }, { passive:false });
    }

    // === Sonido / háptica ===
    let soundEnabled = localStorage.getItem('sound_enabled') === '1';
    let _ac = null;
    function ensureAudio(){ if (!_ac) _ac = new (window.AudioContext||window.webkitAudioContext)(); if (_ac.state==='suspended') _ac.resume(); }
    function beep(type='up'){
      try{ ensureAudio(); const ctx=_ac; const o=ctx.createOscillator(); const g=ctx.createGain();
        o.type='sine'; o.frequency.value = type==='up'?880:440; g.gain.value=0.0001; o.connect(g); g.connect(ctx.destination);
        const now=ctx.currentTime; g.gain.exponentialRampToValueAtTime(0.08, now+0.01); g.gain.exponentialRampToValueAtTime(0.00001, now+0.12);
        o.start(now); o.stop(now+0.14);
      }catch{}
    }
    function feedback(delta){ if (soundEnabled) beep(delta>0?'up':'down'); if (navigator.vibrate) navigator.vibrate(10); }

    // === Totales ===
    function updateTotals(){
      const aCard = document.getElementById('ella');
      const bCard = document.getElementById('el');
      const a = aCard._getValue();
      const b = bCard._getValue();
      const total = a + b;
      const pa = total ? Math.round((a/total)*100) : 0;
      const pb = total ? Math.round((b/total)*100) : 0;
      const nameA = aCard.querySelector('h2.name').textContent || 'Ella';
      const nameB = bCard.querySelector('h2.name').textContent || 'Él';
      const stats = document.getElementById('stats');
      stats.innerHTML = `
        <div class="total">TOTAL: ${total}</div>
        <div class="detail"><span class="name-a">${nameA}</span> ${a} <span class="pct">(${pa}%)</span> · <span class="name-b">${nameB}</span> ${b} <span class="pct">(${pb}%)</span></div>
      `;
    }

    // === Inicializar ===
    setupCounter('ella', 'contador_ella');
    setupCounter('el', 'contador_el');
    setupName('ella','Ella','nombre_ella');
    setupName('el','Él','nombre_el');

    // Reset / Undo / Sonido
    function resetAll(){
      const a=document.getElementById('ella');
      const b=document.getElementById('el');
      if (a && a._setValue) a._setValue(0);
      if (b && b._setValue) b._setValue(0);
      history.length = 0;
      updateTotals();
    }
    const resetBtn = document.getElementById('btn-reset');
    const handleReset = (e) => {
      e.preventDefault();
      e.stopPropagation();
      if (!confirm('¿Reiniciar los dos contadores? Esta acción no se puede deshacer.')) return;
      resetAll();
    };
    // Compatibilidad: pointer (iOS/Android) + click (desktop)
    resetBtn.addEventListener('pointerup', handleReset);
    resetBtn.addEventListener('click', handleReset);

    const soundBtn=document.getElementById('btn-sound');('btn-sound');
    function renderSound(){ soundBtn.classList.toggle('on', soundEnabled); soundBtn.setAttribute('aria-pressed', soundEnabled?'true':'false'); soundBtn.textContent = soundEnabled? 'Sonido: ON' : 'Sonido: OFF'; }
    renderSound();
    soundBtn.addEventListener('click', ()=>{ soundEnabled=!soundEnabled; localStorage.setItem('sound_enabled', soundEnabled?'1':'0'); try{ if(soundEnabled) ensureAudio(); }catch{} renderSound(); });

    // Primer pintado de totales
    updateTotals();

    // === Icono flip-counter neón (apple-touch-icon + favicon) ===
    (function generateIcons(){
      const size = 180; // iOS
      const c = document.createElement('canvas'); c.width=size; c.height=size; const ctx=c.getContext('2d');
      function rrect(x,y,w,h,r){ ctx.beginPath(); ctx.moveTo(x+r,y); ctx.arcTo(x+w,y,x+w,y+h,r); ctx.arcTo(x+w,y+h,x,y+h,r); ctx.arcTo(x,y+h,x,y,r); ctx.arcTo(x,y,x+w,y,r); ctx.closePath(); }
      const bg=ctx.createLinearGradient(0,0,size,size); bg.addColorStop(0,'#0b1226'); bg.addColorStop(1,'#0e1733'); ctx.fillStyle=bg; rrect(0,0,size,size,28); ctx.fill();
      const halo=ctx.createRadialGradient(size*.5,size*.3,6,size*.5,size*.3,size*.9); halo.addColorStop(0,'rgba(0,229,255,0.18)'); halo.addColorStop(1,'rgba(0,229,255,0)'); ctx.fillStyle=halo; rrect(0,0,size,size,28); ctx.fill();
      const inset=20; const panelW=size-inset*2; const panelH=Math.round(size*.56); const panelX=inset; const panelY=Math.round((size-panelH)/2); const panelR=18;
      ctx.save(); ctx.shadowColor='rgba(0,0,0,0.45)'; ctx.shadowBlur=12; ctx.shadowOffsetY=4; ctx.fillStyle='#0a0f22'; rrect(panelX,panelY,panelW,panelH,panelR); ctx.fill(); ctx.restore();
      const pg=ctx.createLinearGradient(0,panelY,0,panelY+panelH); pg.addColorStop(0,'#0f1a34'); pg.addColorStop(0.5,'#0b1427'); pg.addColorStop(1,'#08101f'); ctx.fillStyle=pg; rrect(panelX,panelY,panelW,panelH,panelR); ctx.fill();
      ctx.strokeStyle='rgba(255,255,255,0.10)'; ctx.lineWidth=1.8; ctx.beginPath(); ctx.moveTo(panelX+10,panelY+panelH/2); ctx.lineTo(panelX+panelW-10,panelY+panelH/2); ctx.stroke();
      ctx.strokeStyle='rgba(255,255,255,0.12)'; ctx.lineWidth=1.2; ctx.beginPath(); ctx.moveTo(panelX+panelW/2,panelY+6); ctx.lineTo(panelX+panelW/2,panelY+panelH-6); ctx.stroke();
      function drawZero(x,y,w,h,color){ const t=Math.max(4,Math.floor(w*.16)); const pad=Math.floor(t*.6); const gap=Math.max(4,Math.floor(t*.8)); ctx.save(); ctx.shadowColor=color; ctx.shadowBlur=8; ctx.fillStyle=color; ctx.fillRect(x+pad,y,w-2*pad,t); ctx.fillRect(x+pad,y+h-t,w-2*pad,t); ctx.fillRect(x,y+pad,t,h/2-pad-gap/2); ctx.fillRect(x,y+h/2+gap/2,t,h/2-pad-gap/2); ctx.fillRect(x+w-t,y+pad,t,h/2-pad-gap/2); ctx.fillRect(x+w-t,y+h/2+gap/2,t,h/2-pad-gap/2); ctx.restore(); }
      const gapX=8; const digitW=Math.floor(panelW/2-gapX*1.5); const digitH=Math.floor(panelH-16); const digitY=panelY+(panelH-digitH)/2; const leftX=panelX+gapX; const rightX=panelX+panelW/2+gapX/2; drawZero(leftX,digitY,digitW,digitH,'#ff4d9d'); drawZero(rightX,digitY,digitW,digitH,'#00e5ff');
      const bx=size-22, by=size-22, br=10; const gp=ctx.createRadialGradient(bx-3,by-4,2,bx,by,br); gp.addColorStop(0,'rgba(0,229,255,0.9)'); gp.addColorStop(1,'rgba(0,229,255,0.12)'); ctx.fillStyle=gp; ctx.beginPath(); ctx.arc(bx,by,br,0,Math.PI*2); ctx.fill(); ctx.lineWidth=2; ctx.strokeStyle='#00141a'; ctx.beginPath(); ctx.arc(bx,by,br,0,Math.PI*2); ctx.stroke(); ctx.strokeStyle='#00141a'; ctx.lineWidth=2.2; ctx.beginPath(); ctx.moveTo(bx-5,by); ctx.lineTo(bx+5,by); ctx.stroke(); ctx.beginPath(); ctx.moveTo(bx,by-5); ctx.lineTo(bx,by+5); ctx.stroke();
      const url=c.toDataURL('image/png'); document.getElementById('app-touch-icon').href=url; document.getElementById('app-favicon').href=url;
    })();

    // Fondo reactivo al puntero para un brillo "neón"
    const updateMouseVars=(x,y)=>{ document.documentElement.style.setProperty('--mx', x+'px'); document.documentElement.style.setProperty('--my', y+'px'); };
    window.addEventListener('pointermove', (e)=>updateMouseVars(e.clientX,e.clientY));
    window.addEventListener('pointerdown', (e)=>updateMouseVars(e.clientX||innerWidth/2, e.clientY||innerHeight/2));

    // Bloquear zoom por doble-tap manteniendo pinch-zoom
    let lastTouchEnd=0; document.addEventListener('touchend', (e)=>{ const now=Date.now(); if(now-lastTouchEnd<=300){ e.preventDefault(); } lastTouchEnd=now; }, {passive:false});
  </script>
</body>
</html>
